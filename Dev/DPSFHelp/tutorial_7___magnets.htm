<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- saved from url=(0029)http://www.helpandmanual.com/ -->
<head>
   <title>Tutorial 7 - Magnets</title>
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <meta http-equiv="Content-Style-Type" content="text/css" />
   <link type="text/css" href="default.css" rel="stylesheet" />
<script type="text/javascript" src="helpman_topicinit.js"></script>
<!-- Redirect browser to frame page if page is not in the content frame. -->
<script type="text/javascript">
<!--
if (location.search.lastIndexOf("toc=0")<=0) {
  if (parent.frames.length==0) { parent.location.href="index.html?tutorial_7___magnets.htm"; }
  else { parent.quicksync('a12.8'); }
}
//-->
</script>
<script type="text/javascript" src="highlight.js"></script></head>
<body style="margin: 0px 0px 0px 0px; background: #FFFFFF;" onload="highlight();">
<div id="hmpopupDiv" style="visibility:hidden; position:absolute; z-index:1000; "></div>


<table width="100%" border="0" cellspacing="0" cellpadding="5" bgcolor="#D0D0D0">
  <tr valign="middle">
    <td align="left">
      <p class="p_Heading1"><span class="f_Heading1">Tutorial 7 - Magnets</span></p>

    </td>
    <td align="right">
     <span style="font-size: 9pt">
     <a href="introduction.htm">Top</a>&nbsp;
     <a href="tutorial_6___position__orientation__and_pivot_points.htm">Previous</a>&nbsp;
     <a href="performanceoptimizations.htm">Next</a>
     </span>
    </td>
  </tr>
</table>


<!-- Placeholder for topic body. -->
<table width="100%" border="0" cellspacing="0" cellpadding="5"><tr valign="top"><td align="left">
<p>The <a href="default_particle_systems.htm">Default Particle Systems</a> contain Magnets, where Magnets are objects that can attract and repel particles which are within a specified distance of the Magnet. &nbsp;In this tutorial we will look at the Magnets provided by the Default Particle Systems.</p>
<p>&nbsp;</p>
<p>Load the Tutorial 7 project and open up MyParticleSystem.cs.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-size: 18pt;">Types of Magnets</span></p>
<p>&nbsp;</p>
<p>The Default Particle System classes provide 4 types of Magnets, which are the <span style="font-weight: bold;">MagnetPoint</span>, <span style="font-weight: bold;">MagnetLine</span>, <span style="font-weight: bold;">MagnetLineSegment</span>, and <span style="font-weight: bold;">MagnetPlane</span> classes.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">Point</span> - A single point in 3D space that attracts or repels particles.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">Line</span> - An infinite line in 3D space that attracts or repels particles.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">Line Segment</span> - A line with 2 distinct ends in 3D space that attracts or repels particles.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">Plane</span> - An infinite 2D plane in 3D space that attracts or repels particles.</p>
<p>&nbsp;</p>
<p>All 4 of the provided Magnet classes inherit from the <span style="font-weight: bold;">DefaultParticleSystemMagnet</span> abstract class. &nbsp;This allows you to create your own type of magnet class as long as it too inherits from DefaultParticleSystemMagnet. &nbsp;For example, you may want to create a Plane Segment magnet, a Multi-Line Segment magnet, or a Spiral Line magnet; good luck with the math ;).</p>
<p>&nbsp;</p>
<p>The code for the 4 provided Magnet classes is provided in the DPSF install directory (i.e. C:\DPSF\Templates\DPSF Defaults), and the code that defines how they affect a particle is in the <span style="font-family: 'Consolas'; color: #000000;">CalculateForceMagnetShouldExertOnParticle()</span> function of the DefaultBase.cs file (also in the DPSF Defaults folder).</p>
<p>&nbsp;</p>
<p>TRY IT OUT: To see the different type of effect that each type of Magnet creates, run Tutorial 7. &nbsp;Use the C, V, B, and N keys to toggle between the different Magnet types. &nbsp;You will want to rotate the camera a little bit in order to see the difference between the Line and Plane Magnets. &nbsp;Also, move the Emitter around to see that only particles that are within a certain distance of the Magnet are affected by it.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-size: 18pt;">Magnet Modes</span></p>
<p>&nbsp;</p>
<p>The 4 provided Magnets support 2 modes:</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">Attract</span> - Particles are attracted to the magnet.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">Repel</span> - Particles are repelled away from the magnet.</p>
<p>&nbsp;</p>
<p>TRY IT OUT: When running Tutorial 7, use the H key to toggle between having the current Magnet attract or repel the particles, and then move the Emitter around.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-size: 18pt;">Distance Functions</span></p>
<p>&nbsp;</p>
<p>Each Magnet has a <span style="font-weight: bold;">MinDistance</span> and <span style="font-weight: bold;">MaxDistance</span> property; only particles whose distance from the Magnet falls within this range will be affected by the Magnet. &nbsp;Each Magnet also has a <span style="font-weight: bold;">MaxForce</span> property that helps determine how much a Magnet will affect a particle; &nbsp;The other determining factor is the Magnet's DistanceFunction. &nbsp;The DistanceFuction is used to determine how much affect a Magnet should have on a particle based on the Particle's distance away from the Magnet. &nbsp;For example, should a Magnet have the same amount of pull on a particle that is 5 units away as a particle that is 50 units away, or should it have more of a pull on the closer particle. &nbsp;The DistanceFunctions are used to specify this relationship. &nbsp;There are 7 Distance Functions to choose from:</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">Constant</span> - The Max Force will be applied to the particle regardless of how far away it is from the Magnet.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">Linear</span> - When the Particle is at the Min Distance from the Magnet no force will be applied, when the Particle is at half of the Max Distance from the Magnet 1/2 of the Max Force will be applied, and when the Particle is at the Max Distance from the Magnet the Max Force will be applied to the Particle.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">LinearInverse</span> - When the Particle is at the Min Distance from the Magnet the Max Force will be applied, when the Particle is at half of the Max Distance from the Magnet 1/2 of the Max Force will be applied, and when the Particle is at the Max Distance from the Magnet no force will be applied to the Particle.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">Squared</span> - When the Particle is at the Min Distance from the Magnet no force will be applied, when the Particle is at half of the Max Distance from the Magnet 1/4 of the Max Force will be applied, and when the Particle is at the Max Distance from the Magnet the Max Force will be applied to the Particle.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">SquaredInverse</span> - When the Particle is at the Min Distance from the Magnet the Max Force will be applied, when the Particle is at half of the Max Distance from the Magnet 1/4 of the Max Force will be applied, and when the Particle is at the Max Distance from the Magnet no force will be applied to the Particle.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">Cubed</span> - When the Particle is at the Min Distance from the Magnet no force will be applied, when the Particle is at half of the Max Distance from the Magnet 1/8 of the Max Force will be applied, and when the Particle is at the Max Distance from the Magnet the Max Force will be applied to the Particle.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">CubedInverse</span> - When the Particle is at the Min Distance from the Magnet the Max Force will be applied, when the Particle is at half of the Max Distance from the Magnet 1/8 of the Max Force will be applied, and when the Particle is at the Max Distance from the Magnet no force will be applied to the Particle.</p>
<p>&nbsp;</p>
<p>The Inverse functions are the ones that more accurately model how you would expect a magnet to behave in real life, where the closer a particle gets to the Magnet, the more force the Magnet exerts on the particle.</p>
<p>&nbsp;</p>
<p>TRY IT OUT: When running Tutorial 7, press the M key to toggle between the different Distance Functions. &nbsp;Move the Emitter around and also experiment with switching between Attract and Repel modes.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-size: 18pt;">Affecting Position vs. Velocity</span></p>
<p>&nbsp;</p>
<p>Any Magnets that you create will not have an effect unless you use a Particle Update Function to specify how the Magnets should affect the particles. &nbsp;The Default Particle Systems come with two different Particle Update Functions:</p>
<p>&nbsp;</p>
<p><span style="font-family: 'Consolas'; color: #000000; text-decoration: underline;">UpdateParticlePositionAccordingToMagnets</span> - The Magnets affect the particle's position, but do not affect its velocity. &nbsp;This results in the particles' movement being obviously affected while within the Magnet's range, but suddenly to stop being affected as soon as it is out of the Magnet's range. &nbsp;This is especially apparent when the Magnet is set to repel particles, and may seem unnatural.</p>
<p>&nbsp;</p>
<p><span style="font-family: 'Consolas'; color: #000000; text-decoration: underline;">UpdateParticleVelocityAccordingToMagnets</span> - The Magnets affect the particle's velocity, which in turn affect the particle's position. &nbsp;This results in a smooth transition of the particles' movement when it goes within and out of the Magnets range.</p>
<p>&nbsp;</p>
<p>As mentioned above, the code for these Particle Update functions is shown in the DefaultBase.cs file. &nbsp;In addition to using these 2 Particle Update functions, you can also write your own. &nbsp;Maybe you want to create a magnet that affects a particle's color instead of its position; you could write your own UpdateParticleColorAccordingToMagnets Particle Update function.</p>
<p>&nbsp;</p>
<p>TRY IT OUT: When running Tutorial 7, press the P key to toggle between having the Magnet affect the particles' Position and Velocity. &nbsp;Move the Emitter around, switch between Attract and Repel modes, and try out the different Distance Functions in each of these modes.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-size: 18pt;">Show Me The Code</span></p>
<p>&nbsp;</p>
<p>The Default Particle Systems come with a <span style="font-weight: bold;">MagnetList</span> variable that is meant to hold all of the Magnets that will affect the particle system's particles. &nbsp;In this tutorial we only ever have one magnet active at a time, but you can have as many Magnets as you like. &nbsp;MyParticleSystem.cs shows how to initialize each type of Magnet in the UseMagnetType() function, but for simplicity here I will show the code that you would simply need to add to your particle system's AutoInitialize() function.</p>
<p>&nbsp;</p>
<p>The first thing you need to do is create a magnet. &nbsp;The code below shows how to create a new Point magnet at position (0, 50, 0), that Attracts particles, uses the LinearInverse distance function (so the closer a particle is, the more force will be exerted on it), affects all particles within a distance of 10 to 100 units of the magnet, and exerts at most a force of 200 on the particles.</p>
<p>&nbsp;</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;<span style="font-family: 'Consolas'; color: #2b91af;">MagnetPoint</span><span style="font-family: 'Consolas'; color: #000000;"> pointMagnet = </span><span style="font-family: 'Consolas'; color: #0000ff;">new</span><span style="font-family: 'Consolas'; color: #000000;"> </span><span style="font-family: 'Consolas'; color: #2b91af;">MagnetPoint</span><span style="font-family: 'Consolas'; color: #000000;">(</span><span style="font-family: 'Consolas'; color: #0000ff;">new</span><span style="font-family: 'Consolas'; color: #000000;"> </span><span style="font-family: 'Consolas'; color: #2b91af;">Vector3</span><span style="font-family: 'Consolas'; color: #000000;">(0, 50, 0), </span><span style="font-family: 'Consolas'; color: #2b91af;">DefaultParticleSystemMagnet</span><span style="font-family: 'Consolas'; color: #000000;">.</span><span style="font-family: 'Consolas'; color: #2b91af;">MagnetModes</span><span style="font-family: 'Consolas'; color: #000000;">.Attract, </span></p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="font-family: 'Consolas'; color: #2b91af;">DefaultParticleSystemMagnet</span><span style="font-family: 'Consolas'; color: #000000;">.</span><span style="font-family: 'Consolas'; color: #2b91af;">DistanceFunctions</span><span style="font-family: 'Consolas'; color: #000000;">.LinearInverse, 10, 100, 200, 0);</span></p>
<p>&nbsp;</p>
<p>Then add your new Magnet to the particle system's MagnetList:</p>
<p>&nbsp;</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;<span style="font-family: 'Consolas'; color: #000000;">MagnetList.Add(pointMagnet);</span></p>
<p>&nbsp;</p>
<p>And finally, to have the Magnet affect the particle system's particles, make sure you have an EveryTimeEvent setup:</p>
<p>&nbsp;</p>
<p><span style="font-family: 'Consolas'; color: #000000;"> &nbsp; &nbsp;ParticleEvents.AddEveryTimeEvent(UpdateParticlePositionAccordingToMagnets);</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>And that's it; With 3 lines of code you can have one of the built-in Magnets affecting your particle system's particles (technically this could be done it 2 lines of code by creating the new Magnet directly in the MagnetList.Add() function.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-size: 18pt;">Remarks</span></p>
<p>&nbsp;</p>
<p>Play around with the Tutorial 7 application. &nbsp;Use the onscreen keys to change between the different types of Magnets and Distance Functions to see how they differ. &nbsp;You'll likely notice that some combinations of settings cause the particles to seem to freak out and jump all over the place. &nbsp;Change the source code to change the Min and Max distance that the magnets affect particles at. &nbsp;Try changing the source code to have 2 Magnets active at once.</p>
<p>&nbsp;</p>

</td></tr></table>

</body>
</html>
